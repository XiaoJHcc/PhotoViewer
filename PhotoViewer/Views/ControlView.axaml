<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:PhotoViewer.ViewModels"
             xmlns:local="clr-namespace:PhotoViewer.Views"
             xmlns:converters="clr-namespace:PhotoViewer.Converters"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="PhotoViewer.Views.ControlView"
             x:DataType="vm:ControlViewModel">

    <UserControl.Styles>
        <!-- 控制按钮样式 -->
        <Style Selector="Button.ControlButton">
            <Setter Property="Width" Value="40" />
            <Setter Property="Height" Value="40" />
            <Setter Property="Background" Value="#333" />
            <Setter Property="BorderBrush" Value="#555" />
            <Setter Property="Margin" Value="0" />
        </Style>

        <Style Selector="Button.ControlButton:pointerover">
            <Setter Property="Background" Value="#444" />
        </Style>

        <!-- 按钮文字样式 -->
        <Style Selector="TextBlock.ControlButtonSymbol">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontWeight" Value="Regular" />
            <Setter Property="FontFamily" Value="{StaticResource UiconsFontRegularRounded}" />
        </Style>

        <!-- 星级按钮样式 -->
        <Style Selector="Button.StarButton">
            <Setter Property="Width" Value="30" />
            <Setter Property="Height" Value="30" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <Style Selector="Button.StarButton:pointerover">
            <Setter Property="Background" Value="#333" />
        </Style>

        <Style Selector="TextBlock.StarButtonSymbol">
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontFamily" Value="{StaticResource UiconsFontSolidStraight}" />
        </Style>

        <!-- EXIF 文本样式 -->
        <Style Selector="Border.ExifBlockBorder">
            <Setter Property="Width" Value="50" />
            <Setter Property="Height" Value="40" />
            <Setter Property="Background" Value="#222" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Margin"
                    Value="{Binding $parent[UserControl].((vm:ControlViewModel)DataContext).IsVerticalLayout, 
                            Converter={x:Static converters:MarginConverter.Instance}, 
                            ConverterParameter='0,4,0,4|4,0,4,0'}" />
            
        </Style>
        <Style Selector="StackPanel.ExifBlock">
            <Setter Property="Spacing" Value="2" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <Style Selector="TextBlock.ExifLabel">
            <Setter Property="FontSize" Value="10" />
            <Setter Property="Foreground" Value="#AAA" />
            <Setter Property="HorizontalAlignment" Value="Center" />
        </Style>

        <Style Selector="TextBlock.ExifValue">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Foreground" Value="#FFF" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="HorizontalAlignment" Value="Center" />
        </Style>
    </UserControl.Styles>

    <Border Padding="10"
            VerticalAlignment="Stretch"
            HorizontalAlignment="Stretch">

        <!-- 主要布局：可换行的线性布局 -->
        <WrapPanel
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            ItemsAlignment="Center"
            Orientation="{Binding IsVerticalLayout, 
                Converter={x:Static converters:LayoutOrientationConverter.Instance}}"
            LineSpacing="10"
            ItemSpacing="20">

            <!-- 区域1：EXIF信息 -->
            <Border
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
                <ItemsControl ItemsSource="{Binding EnabledExifItems}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Spacing="4"
                                Orientation="{Binding $parent[UserControl].((vm:ControlViewModel)DataContext).IsVerticalLayout, 
                                    Converter={x:Static converters:LayoutOrientationConverter.Instance}}"
                                Margin="{Binding $parent[UserControl].((vm:ControlViewModel)DataContext).IsVerticalLayout, 
                                    Converter={x:Static converters:MarginConverter.Instance}, 
                                    ConverterParameter='0,0,0,0|10,0,10,0'}" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="vm:SettingsViewModel+ExifDisplayItem">
                            <Border Classes="ExifBlockBorder">
                                <StackPanel Classes="ExifBlock">
                                    <TextBlock Classes="ExifLabel" Text="{Binding DisplayName}" />
                                    <TextBlock Classes="ExifValue">
                                        <TextBlock.Text>
                                            <MultiBinding Converter="{x:Static local:ExifValueConverter.Instance}">
                                                <Binding Path="$parent[UserControl].((vm:ControlViewModel)DataContext).CurrentExifData" />
                                                <Binding Path="PropertyName" />
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Border>

            <!-- 区域2：星级评分 -->
            <Border
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
                <DockPanel HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Margin="{Binding IsVerticalLayout, 
                                    Converter={x:Static converters:BorderThicknessConverter.Instance}, 
                                    ConverterParameter='0,0,0,8|0,0,8,0'}">

                    <!-- 0星按钮 - 始终在左侧/底部 -->
                    <Button Classes="StarButton"
                            Click="OnRatingButtonClick"
                            Tag="0"
                            ToolTip.Tip="无星级"
                            DockPanel.Dock="{Binding IsVerticalLayout, 
                                    Converter={x:Static converters:DockConverter.Instance}, 
                                    ConverterParameter='Bottom,Left'}">
                        <TextBlock Classes="StarButtonSymbol" Text="&#xf4f8;" FontSize="12" Foreground="#666" />
                    </Button>

                    <!-- 1星按钮 -->
                    <Button Classes="StarButton"
                            Click="OnRatingButtonClick"
                            Tag="1"
                            ToolTip.Tip="1星"
                            DockPanel.Dock="{Binding IsVerticalLayout, 
                                    Converter={x:Static converters:DockConverter.Instance}, 
                                    ConverterParameter='Bottom,Left'}">
                        <TextBlock Classes="StarButtonSymbol" Text="&#xfcd7;"
                                   Foreground="{Binding Rating, 
                                            Converter={x:Static local:StarColorConverter.Instance}, 
                                            ConverterParameter=1}" />
                    </Button>

                    <!-- 2星按钮 -->
                    <Button Classes="StarButton"
                            Click="OnRatingButtonClick"
                            Tag="2"
                            ToolTip.Tip="2星"
                            DockPanel.Dock="{Binding IsVerticalLayout, 
                                    Converter={x:Static converters:DockConverter.Instance}, 
                                    ConverterParameter='Bottom,Left'}">
                        <TextBlock Classes="StarButtonSymbol" Text="&#xfcd7;"
                                   Foreground="{Binding Rating, 
                                            Converter={x:Static local:StarColorConverter.Instance}, 
                                            ConverterParameter=2}" />
                    </Button>

                    <!-- 3星按钮 -->
                    <Button Classes="StarButton"
                            Click="OnRatingButtonClick"
                            Tag="3"
                            ToolTip.Tip="3星"
                            DockPanel.Dock="{Binding IsVerticalLayout, 
                                    Converter={x:Static converters:DockConverter.Instance}, 
                                    ConverterParameter='Bottom,Left'}">
                        <TextBlock Classes="StarButtonSymbol" Text="&#xfcd7;"
                                   Foreground="{Binding Rating, 
                                            Converter={x:Static local:StarColorConverter.Instance}, 
                                            ConverterParameter=3}" />
                    </Button>

                    <!-- 4星按钮 -->
                    <Button Classes="StarButton"
                            Click="OnRatingButtonClick"
                            Tag="4"
                            ToolTip.Tip="4星"
                            DockPanel.Dock="{Binding IsVerticalLayout, 
                                    Converter={x:Static converters:DockConverter.Instance}, 
                                    ConverterParameter='Bottom,Left'}">
                        <TextBlock Classes="StarButtonSymbol" Text="&#xfcd7;"
                                   Foreground="{Binding Rating, 
                                            Converter={x:Static local:StarColorConverter.Instance}, 
                                            ConverterParameter=4}" />
                    </Button>

                    <!-- 5星按钮 - 最后一个，占据剩余空间 -->
                    <Button Classes="StarButton"
                            Click="OnRatingButtonClick"
                            Tag="5"
                            ToolTip.Tip="5星">
                        <TextBlock Classes="StarButtonSymbol" Text="&#xfcd7;"
                                   Foreground="{Binding Rating, 
                                            Converter={x:Static local:StarColorConverter.Instance}, 
                                            ConverterParameter=5}" />
                    </Button>
                </DockPanel>
            </Border>

            <!-- 区域3：控制按钮 -->
            <Border HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch">
                <ItemsControl ItemsSource="{Binding EnabledControls}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Spacing="8"
                                        Orientation="{Binding $parent[UserControl].((vm:ControlViewModel)DataContext).IsVerticalLayout, 
                                            Converter={x:Static converters:LayoutOrientationConverter.Instance}}" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="vm:SettingsViewModel+HotkeyItem">
                            <Button Classes="ControlButton"
                                    ToolTip.Tip="{Binding Tooltip}"
                                    Click="OnControlButtonClick"
                                    Tag="{Binding Command}">
                                <TextBlock Classes="ControlButtonSymbol"
                                           Text="{Binding DisplaySymbol}" />
                            </Button>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Border>
        </WrapPanel>
    </Border>
</UserControl>