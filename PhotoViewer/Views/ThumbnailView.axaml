<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:PhotoViewer.Views"
             xmlns:vm="clr-namespace:PhotoViewer.ViewModels"
             xmlns:i="clr-namespace:Avalonia.Xaml.Interactivity;assembly=Avalonia.Xaml.Interactivity"
             xmlns:core="clr-namespace:PhotoViewer.Core"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="120"
             x:Class="PhotoViewer.Views.ThumbnailView"
             x:DataType="vm:ThumbnailViewModel">
    
    <UserControl.Resources>
        <!-- 布尔到边框颜色转换器 -->
        <local:BoolToCurrentBorderConverter x:Key="BoolToBorderConverter"/>
        
        <!-- 文件大小转换器 -->
        <local:FileSizeConverter x:Key="FileSizeConverter"/>
        
        <!-- 日期格式转换器 -->
        <local:DateTimeConverter x:Key="DateTimeConverter"/>
    </UserControl.Resources>
    
 <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- 排序工具栏 -->
        <StackPanel Grid.Row="0" 
                    Orientation="Horizontal" 
                    Spacing="10" 
                    Margin="5" 
                    HorizontalAlignment="Center">
            <!-- <ComboBox Name="SortByComboBox" -->
            <!--           ItemsSource="{Binding SortModes}" -->
            <!--           SelectedItem="{Binding SortMode}" -->
            <!--           Width="100"/> -->
            <!-- <ComboBox Name="OrderComboBox"  -->
            <!--           ItemsSource="{Binding SortOrders}" -->
            <!--           SelectedItem="{Binding SortOrder}" -->
            <!--           Width="80"/> -->
            <ComboBox Name="SortByComboBox"
                      ItemsSource="{Binding SortModes}"
                      SelectedValue="{Binding SortMode}"
                      SelectedValueBinding="{Binding Value}"
                      Width="100">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding DisplayName}"/>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
            <ComboBox Name="OrderComboBox"
                      ItemsSource="{Binding SortOrders}"
                      SelectedValue="{Binding SortOrder}"
                      SelectedValueBinding="{Binding Value}"
                      Width="100">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding DisplayName}"/>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
            <!-- <Button Name="CenterButton"  -->
            <!--         Content="当前张"  -->
            <!--         Width="80" -->
            <!--         Command="{Binding CenterCommand}"/> -->
        </StackPanel>
        
        <!-- 缩略图列表 -->
        <ScrollViewer Grid.Row="1" 
                      Name="ThumbnailScrollViewer" 
                      HorizontalScrollBarVisibility="Auto" 
                      VerticalScrollBarVisibility="Disabled">
            <i:Interaction.Behaviors>
                <core:HorizontalScrollWheelBehavior/>
            </i:Interaction.Behaviors>
            
            <ItemsControl Name="ThumbnailItemsControl"
                          ItemsSource="{Binding Main.FilteredFiles}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="10"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        
                        <Button Command="{Binding $parent[UserControl].((vm:ThumbnailViewModel)DataContext).SelectImageCommand}"
                                CommandParameter="{Binding}"
                                Background="Transparent"
                                BorderThickness="0"
                                Margin="0"
                                Padding="0">
                            <Border BorderThickness="2" 
                                    BorderBrush="{Binding IsCurrent, Converter={StaticResource BoolToBorderConverter}}"
                                    CornerRadius="4"
                                    Margin="0"
                                    Padding="5"
                                    Width="90"
                                    Height="140"
                                    Background="#555555">
                                <StackPanel Orientation="Vertical" Spacing="5">
                                    <!-- 缩略图容器 -->
                                    <Border Width="80" 
                                            Height="80" 
                                            Background="#333333"
                                            CornerRadius="3"
                                            BorderThickness="1"
                                            BorderBrush="#505050">
                                        <Image Source="{Binding Thumbnail}" 
                                               Stretch="Uniform"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"/>
                                    </Border>
                                    
                                    <!-- 文件信息 -->
                                    <StackPanel Orientation="Vertical" Spacing="2">
                                        <TextBlock Text="{Binding Name}" 
                                                   TextWrapping="NoWrap"
                                                   TextTrimming="CharacterEllipsis"
                                                   Foreground="#EEEEEE"
                                                   FontSize="10"
                                                   FontWeight="SemiBold"
                                                   HorizontalAlignment="Center"
                                                   MaxWidth="110"/>
                                        
                                        <TextBlock Text="{Binding FileSize, Converter={StaticResource FileSizeConverter}}" 
                                                   FontSize="9"
                                                   Foreground="#AAAAAA"
                                                   HorizontalAlignment="Center"/>
                                        
                                        <TextBlock Text="{Binding ModifiedDate, Converter={StaticResource DateTimeConverter}}" 
                                                   FontSize="9"
                                                   Foreground="#AAAAAA"
                                                   HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </Button>
                        
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>
